
<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>BOL Timer – Admin</title>
  <meta name="theme-color" content="#00539f">
  <style>
:root{--tesco-blue:#00539f;--tesco-red:#e41e26;--bg:#f8fafc;--card:#ffffff;--muted:#6b7280;--radius:16px}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#0f172a}
.wrap{max-width:1000px;margin:0 auto;padding:18px}
h1{margin:0 0 6px;color:var(--tesco-blue);font-weight:900;letter-spacing:.2px}
h2{margin:0 0 10px;color:#111827}
.muted{color:var(--muted)}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:var(--radius);box-shadow:0 8px 22px rgba(0,0,0,.04);padding:16px;margin:12px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
label{font-weight:800;display:block;margin-bottom:6px}
input,select{padding:12px;border:2px solid var(--tesco-blue);border-radius:12px;width:100%;font-size:16px}
.btn{padding:12px 16px;border-radius:12px;border:2px solid var(--tesco-blue);background:var(--tesco-blue);color:#fff;font-weight:800;cursor:pointer}
.btn.ghost{background:#fff;color:var(--tesco-blue)}
.btn.danger{background:var(--tesco-red);border-color:var(--tesco-red)}
.btn.gray{background:#fff;color:#111;border-color:#e5e7eb}
.timer{font-size:40px;font-weight:900;color:var(--tesco-red)}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:9px;border-bottom:1px solid #e5e7eb}
th{border-bottom:2px solid var(--tesco-blue);text-align:left;background:#f1f5f9}
/* camera modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
.modal.show{display:flex}
.modal .box{background:#fff;border-radius:16px;max-width:420px;width:100%;padding:14px;border:1px solid #e5e7eb}
.video-wrap{position:relative}
video{width:100%;background:#000;border-radius:12px;max-height:260px}
canvas{display:none}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#dbeafe;color:#1e3a8a;font-weight:800}
.note{background:#fff3cd;border:1px solid #ffe08a;color:#7a5d00;border-radius:8px;padding:8px 10px}
footer{margin-top:24px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Admin – BOL Timer</h1>
    <div id="loginCard" class="card" style="display:none">
      <h2>Prihlásenie</h2>
      <div class="row">
        <div style="flex:1 1 220px">
          <label>Meno</label>
          <input id="u" placeholder="admin" autocomplete="username" />
        </div>
        <div style="flex:1 1 220px">
          <label>Heslo</label>
          <input id="p" type="password" placeholder="admin" autocomplete="current-password" />
        </div>
        <div style="flex:0 0 160px;align-self:flex-end">
          <button id="loginBtn" class="btn">Prihlásiť</button>
        </div>
      </div>
      <p class="note">Demo prístup: <b>admin / admin</b></p>
    </div>

    <div id="adminUI" style="display:none">
      <div class="card">
        <h2>Záznamy</h2>
        <div class="row">
          <div><label>Dátum od</label><input id="from" type="date"></div>
          <div><label>Dátum do</label><input id="to" type="date"></div>
          <div style="align-self:flex-end"><button id="filter" class="btn ghost">Filtrovať</button></div>
          <div style="margin-left:auto;align-self:flex-end;display:flex;gap:8px">
            <button id="export" class="btn ghost">Export CSV</button>
            <button id="clear" class="btn danger">Vymazať všetko</button>
          </div>
        </div>
        <table>
          <thead><tr><th></th><th>Kód</th><th>Meno</th><th>Štart</th><th>Koniec</th><th>Čistý čas</th><th>Pauzy</th><th>Zostalo</th></tr></thead>
          <tbody id="tbl"></tbody>
        </table>
      </div>
    </div>

    <footer>© Tesco – admin rozhranie</footer>
  </div>

  <script>
    const KEY='bol_timer_pro_v1';
    const $=s=>document.querySelector(s);
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'{"tasks":[]}'); }catch(e){ return {"tasks":[]}; } }
    function save(db){ localStorage.setItem(KEY, JSON.stringify(db)); }

    const ok = sessionStorage.getItem('admin_ok')==='1';
    const loginCard=$('#loginCard'), adminUI=$('#adminUI');
    function showLogin(){ loginCard.style.display='block'; adminUI.style.display='none'; }
    function showAdmin(){ loginCard.style.display='none'; adminUI.style.display='block'; initAdmin(); }
    if(ok) showAdmin(); else showLogin();
    document.getElementById('loginBtn').onclick=()=>{ const u=$('#u').value.trim(), p=$('#p').value.trim(); if(u==='admin' && p==='admin'){ sessionStorage.setItem('admin_ok','1'); showAdmin(); } else alert('Nesprávne údaje'); };

    function fmt(n){return String(n).padStart(2,'0');}
    function fmtHMS(ms){const s=Math.floor(ms/1000);const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return fmt(h)+':'+fmt(m)+':'+fmt(sec);}

    function renderRange(){ const db=load(); const f=$('#from').value, t=$('#to').value; const tr=$('#tbl'); tr.innerHTML='';
      const list=db.tasks.filter(x=>!f || x.startISO.slice(0,10)>=f).filter(x=>!t || x.startISO.slice(0,10)<=t).sort((a,b)=>new Date(a.startISO)-new Date(b.startISO));
      list.forEach((r)=>{ const row=document.createElement('tr'); row.innerHTML='<td><button data-id="'+r.id+'" class="btn gray" style="padding:6px 10px">Zmazať</button></td><td>'+r.code+'</td><td>'+r.name+'</td><td>'+new Date(r.startISO).toLocaleString('sk-SK')+'</td><td>'+new Date(r.endISO).toLocaleString('sk-SK')+'</td><td style="color:var(--tesco-red);font-weight:800">'+fmtHMS(r.cleanMs)+'</td><td>'+r.pauses+'</td><td>'+(r.leftoverCartons||0)+'</td>'; tr.appendChild(row); });
      tr.querySelectorAll('button[data-id]').forEach(b=>b.onclick=()=>{ const id=b.getAttribute('data-id'); const db2=load(); db2.tasks=db2.tasks.filter(x=>String(x.id)!==String(id)); save(db2); renderRange(); });
    }

    function initAdmin(){
      const today=new Date().toISOString().slice(0,10);
      document.getElementById('from').value = today;
      document.getElementById('to').value = today;
      renderRange();
      document.getElementById('filter').onclick=renderRange;
      document.getElementById('clear').onclick=()=>{ if(!confirm('Naozaj vymazať všetky záznamy?')) return; const db=load(); db.tasks=[]; save(db); renderRange(); };
      document.getElementById('export').onclick=()=>{ const db=load(); const f=document.getElementById('from').value, t=document.getElementById('to').value; const rows=db.tasks.filter(x=>!f || x.startISO.slice(0,10)>=f).filter(x=>!t || x.startISO.slice(0,10)<=t).sort((a,b)=>new Date(a.startISO)-new Date(b.startISO));
        if(rows.length===0) return alert('Žiadne záznamy v rozsahu.');
        const esc=s=> '"'+String(s).replace(/"/g,'""')+'"';
        let csv=['BOL','Meno','Štart','Koniec','Čistý čas','Pauzy','Zostalo'].join(',')+'\n';
        rows.forEach(t=>{ csv += [t.code,esc(t.name),new Date(t.startISO).toLocaleString('sk-SK'),new Date(t.endISO).toLocaleString('sk-SK'),fmtHMS(t.cleanMs),t.pauses,t.leftoverCartons].join(',')+'\n'; });
        const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='BOL_timer_export.csv'; a.click();
      };
    }
  </script>
</body>
</html>
